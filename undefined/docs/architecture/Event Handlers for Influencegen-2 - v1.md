# Specification

# 1. Event Driven Architecture Analysis

- **System Overview:**
  
  - **Analysis Date:** 2025-06-13
  - **Architecture Type:** LayeredArchitecture with Webhook/Callback Integration for Asynchronous Tasks
  - **Technology Stack:**
    
    - Odoo 18 (Python, OWL, XML)
    - N8N
    - PostgreSQL
    - AI Service (Flux LoRA models via REST)
    
  - **Bounded Contexts:**
    
    - AI Image Generation Orchestration (Odoo-N8N Interaction)
    - Odoo Core Platform Services (internal state management and notifications)
    
  
- **Project Specific Events:**
  
  - **Event Id:** EVT-AIG-001  
**Event Name:** AIImageGenerationRequested  
**Event Type:** integration  
**Category:** AI Image Generation  
**Description:** Odoo requests N8N to generate an AI image via a webhook call.  
**Trigger Condition:** User action in Odoo UI to generate AI image (REQ-AIGS-001).  
**Source Context:** InfluenceGen Odoo Infrastructure & Integration Services Layer  
**Target Contexts:**
    
    - N8N Orchestration Layer
    
**Payload:**
    
    - **Schema:**
      
      - **Type:** object
      - **Properties:**
        
        - **Request Id:**
          
          - **Type:** string
          - **Format:** uuid
          - **Description:** Unique ID for this generation request, generated by Odoo.
          
        - **Correlation Id:**
          
          - **Type:** string
          - **Format:** uuid
          - **Description:** ID for tracing the request across components (REQ-ATEL-009).
          
        - **User Id:**
          
          - **Type:** string
          - **Format:** uuid
          - **Description:** ID of the user initiating the request.
          
        - **Prompt:**
          
          - **Type:** string
          - **Description:** Main text prompt for image generation.
          
        - **Negative Prompt:**
          
          - **Type:** string
          - **Description:** Negative prompt inputs.
          
        - **Model Id:**
          
          - **Type:** string
          - **Format:** uuid
          - **Description:** ID of the selected AI model (e.g., Flux LoRA model).
          
        - **Resolution:**
          
          - **Type:** string
          - **Description:** Image resolution (e.g., '1024x1024').
          
        - **Aspect Ratio:**
          
          - **Type:** string
          - **Description:** Image aspect ratio (e.g., '1:1').
          
        - **Seed:**
          
          - **Type:** integer
          - **Description:** Seed for generation (optional).
          
        - **Inference Steps:**
          
          - **Type:** integer
          - **Description:** Number of inference steps.
          
        - **Cfg Scale:**
          
          - **Type:** number
          - **Description:** CFG scale value.
          
        - **Campaign Id:**
          
          - **Type:** string
          - **Format:** uuid
          - **Description:** ID of the campaign if image is for a campaign (optional).
          
        - **Callback Url:**
          
          - **Type:** string
          - **Format:** uri
          - **Description:** Odoo API endpoint for N8N to send results back to.
          
        
      - **Required:**
        
        - requestId
        - correlationId
        - userId
        - prompt
        - modelId
        - resolution
        - aspectRatio
        - callbackUrl
        
      
    - **Required Fields:**
      
      - requestId
      - correlationId
      - userId
      - prompt
      - modelId
      - resolution
      - aspectRatio
      - callbackUrl
      
    - **Optional Fields:**
      
      - negativePrompt
      - seed
      - inferenceSteps
      - cfgScale
      - campaignId
      
    
**Frequency:** medium  
**Business Criticality:** important  
**Data Source:**
    
    - **Database:** N/A
    - **Table:** N/A
    - **Operation:** read
    
**Routing:**
    
    - **Routing Key:** N/A (Direct Webhook Call)
    - **Exchange:** N/A
    - **Queue:** N/A (N8N Webhook Node)
    
**Consumers:**
    
    - **Service:** N8N Orchestration Layer  
**Handler:** AI Image Generation Workflow  
**Processing Type:** async  
    
**Dependencies:**
    
    - REQ-AIGS-001
    - REQ-IL-002
    - REQ-AIGS-010
    
**Error Handling:**
    
    - **Retry Strategy:** Odoo to implement HTTP retry logic with backoff for webhook call (REQ-IL-009).
    - **Dead Letter Queue:** Odoo logs persistent failures to call N8N webhook; N8N handles its own input queue if applicable.
    - **Timeout Ms:** 30000
    
  - **Event Id:** EVT-AIG-002  
**Event Name:** AIImageGenerationCompleted  
**Event Type:** integration  
**Category:** AI Image Generation  
**Description:** N8N informs Odoo via callback that AI image generation was successful.  
**Trigger Condition:** N8N workflow successfully generates image and prepares results (REQ-AIGS-001).  
**Source Context:** N8N Orchestration Layer  
**Target Contexts:**
    
    - InfluenceGen Odoo Infrastructure & Integration Services Layer (Callback API)
    
**Payload:**
    
    - **Schema:**
      
      - **Type:** object
      - **Properties:**
        
        - **Request Id:**
          
          - **Type:** string
          - **Format:** uuid
          - **Description:** Unique ID of the original generation request.
          
        - **Correlation Id:**
          
          - **Type:** string
          - **Format:** uuid
          - **Description:** ID for tracing the request across components.
          
        - **Status:**
          
          - **Type:** string
          - **Enum:**
            
            - completed
            
          - **Description:** Status of the generation.
          
        - **Image Data:**
          
          - **Type:** string
          - **Format:** byte
          - **Description:** Base64 encoded image data (if not using URL).
          
        - **Image Url:**
          
          - **Type:** string
          - **Format:** uri
          - **Description:** Secure temporary URL to download the image (if not sending data directly).
          
        - **Image Metadata:**
          
          - **Type:** object
          - **Properties:**
            
            - **Format:**
              
              - **Type:** string
              
            - **Size:**
              
              - **Type:** integer
              
            - **Width:**
              
              - **Type:** integer
              
            - **Height:**
              
              - **Type:** integer
              
            
          - **Required:**
            
            - format
            - size
            - width
            - height
            
          
        - **Hash Value:**
          
          - **Type:** string
          - **Description:** Cryptographic hash of the image file (REQ-AIGS-006).
          
        
      - **Required:**
        
        - requestId
        - correlationId
        - status
        - imageMetadata
        - hashValue
        
      - **One Of:**
        
        - **Required:**
    
    - imageData
    
        - **Required:**
    
    - imageUrl
    
        
      
    - **Required Fields:**
      
      - requestId
      - correlationId
      - status
      - imageMetadata
      - hashValue
      
    - **Optional Fields:**
      
      
    
**Frequency:** medium  
**Business Criticality:** important  
**Data Source:**
    
    - **Database:** N/A
    - **Table:** N/A
    - **Operation:** read
    
**Routing:**
    
    - **Routing Key:** N/A (Direct API Call to Odoo Callback)
    - **Exchange:** N/A
    - **Queue:** N/A
    
**Consumers:**
    
    - **Service:** InfluenceGen Odoo Infrastructure & Integration Services Layer  
**Handler:** AIImageResultCallbackHandler (Controller/Service)  
**Processing Type:** async (from N8N's perspective)  
    
**Dependencies:**
    
    - REQ-AIGS-001
    - REQ-IL-003
    - REQ-IL-010
    - REQ-AIGS-010
    
**Error Handling:**
    
    - **Retry Strategy:** N8N to implement HTTP retry logic with backoff for callback call (REQ-IL-009).
    - **Dead Letter Queue:** N8N can configure a DLQ for persistent Odoo callback failures (REQ-IL-009).
    - **Timeout Ms:** 60000
    
  - **Event Id:** EVT-AIG-003  
**Event Name:** AIImageGenerationFailed  
**Event Type:** integration  
**Category:** AI Image Generation  
**Description:** N8N informs Odoo via callback that AI image generation failed.  
**Trigger Condition:** N8N workflow encounters an unrecoverable error during AI image generation process (REQ-AIGS-001).  
**Source Context:** N8N Orchestration Layer  
**Target Contexts:**
    
    - InfluenceGen Odoo Infrastructure & Integration Services Layer (Callback API)
    
**Payload:**
    
    - **Schema:**
      
      - **Type:** object
      - **Properties:**
        
        - **Request Id:**
          
          - **Type:** string
          - **Format:** uuid
          - **Description:** Unique ID of the original generation request.
          
        - **Correlation Id:**
          
          - **Type:** string
          - **Format:** uuid
          - **Description:** ID for tracing the request across components.
          
        - **Status:**
          
          - **Type:** string
          - **Enum:**
            
            - failed
            
          - **Description:** Status of the generation.
          
        - **Error Code:**
          
          - **Type:** string
          - **Description:** Error code, if available.
          
        - **Error Message:**
          
          - **Type:** string
          - **Description:** Detailed error message.
          
        
      - **Required:**
        
        - requestId
        - correlationId
        - status
        - errorMessage
        
      
    - **Required Fields:**
      
      - requestId
      - correlationId
      - status
      - errorMessage
      
    - **Optional Fields:**
      
      - errorCode
      
    
**Frequency:** low  
**Business Criticality:** important  
**Data Source:**
    
    - **Database:** N/A
    - **Table:** N/A
    - **Operation:** read
    
**Routing:**
    
    - **Routing Key:** N/A (Direct API Call to Odoo Callback)
    - **Exchange:** N/A
    - **Queue:** N/A
    
**Consumers:**
    
    - **Service:** InfluenceGen Odoo Infrastructure & Integration Services Layer  
**Handler:** AIImageResultCallbackHandler (Controller/Service)  
**Processing Type:** async (from N8N's perspective)  
    
**Dependencies:**
    
    - REQ-AIGS-001
    - REQ-IL-003
    - REQ-AIGS-010
    
**Error Handling:**
    
    - **Retry Strategy:** N8N to implement HTTP retry logic with backoff for callback call (REQ-IL-009).
    - **Dead Letter Queue:** N8N can configure a DLQ for persistent Odoo callback failures (REQ-IL-009).
    - **Timeout Ms:** 60000
    
  
- **Event Types And Schema Design:**
  
  - **Essential Event Types:**
    
    - **Event Name:** AIImageGenerationRequested  
**Category:** integration  
**Description:** Request from Odoo to N8N to start AI image generation.  
**Priority:** high  
    - **Event Name:** AIImageGenerationCompleted  
**Category:** integration  
**Description:** Notification from N8N to Odoo about successful image generation.  
**Priority:** high  
    - **Event Name:** AIImageGenerationFailed  
**Category:** integration  
**Description:** Notification from N8N to Odoo about failed image generation.  
**Priority:** high  
    
  - **Schema Design:**
    
    - **Format:** JSON
    - **Reasoning:** REQ-IL-004 specifies JSON for data exchange in custom APIs. It's lightweight and widely supported by Odoo and N8N.
    - **Consistency Approach:** Defined and versioned payload structures for each event type. Common fields like `requestId` and `correlationId` for linking.
    
  - **Schema Evolution:**
    
    - **Backward Compatibility:** True
    - **Forward Compatibility:** False
    - **Strategy:** Primarily additive changes for JSON payloads. For breaking changes in Odoo's callback API, a new API version endpoint (e.g., /v2/callback) will be introduced. N8N workflows will be updated to call the new endpoint version.
    
  - **Event Structure:**
    
    - **Standard Fields:**
      
      - requestId (domain-specific correlation)
      - correlationId (cross-system trace ID)
      - timestamp (implicit in HTTP headers/N8N logs)
      - status (for result events)
      
    - **Metadata Requirements:**
      
      - Source component (implicit by endpoint)
      - Target component (implicit by endpoint)
      
    
  
- **Event Routing And Processing:**
  
  - **Routing Mechanisms:**
    
    - **Type:** HTTP Webhook (Odoo to N8N)  
**Description:** Odoo triggers N8N workflow via a secure HTTP POST request to a specific N8N webhook URL.  
**Use Case:** Initiating AIImageGenerationRequested events (REQ-IL-002).  
    - **Type:** HTTP Callback API (N8N to Odoo)  
**Description:** N8N sends results (success/failure) to a dedicated, secure Odoo REST API endpoint via HTTP POST.  
**Use Case:** Delivering AIImageGenerationCompleted and AIImageGenerationFailed events (REQ-IL-003).  
    
  - **Processing Patterns:**
    
    - **Pattern:** asynchronous request-response (via callback)  
**Applicable Scenarios:**
    
    - AI image generation workflow
    
**Implementation:** Odoo sends request to N8N and doesn't wait for completion. N8N processes independently and calls back Odoo with the result.  
    
  - **Filtering And Subscription:**
    
    - **Filtering Mechanism:** N/A - Direct HTTP calls to specific endpoints. No broker-based filtering needed.
    - **Subscription Model:** N/A - N8N webhook is a dedicated subscriber to Odoo's request. Odoo's callback endpoint is a dedicated subscriber to N8N's result.
    - **Routing Keys:**
      
      
    
  - **Handler Isolation:**
    
    - **Required:** True
    - **Approach:** N8N workflows run in isolated N8N execution environments. Odoo callback API is handled by a dedicated Odoo HTTP controller/service method.
    - **Reasoning:** Standard practice for webhook/API integrations to ensure separation of concerns and independent processing.
    
  - **Delivery Guarantees:**
    
    - **Level:** at-least-once
    - **Justification:** REQ-IL-009 mandates retry logic for integration points. Combined with idempotent handlers (using `requestId`), this achieves at-least-once reliable processing.
    - **Implementation:** Odoo client code calling N8N webhook to implement retries. N8N HTTP Request node configured for retries when calling Odoo callback. Odoo callback API handler checks `requestId` to prevent duplicate processing of the same event.
    
  
- **Event Storage And Replay:**
  
  - **Persistence Requirements:**
    
    - **Required:** False
    - **Duration:** N/A
    - **Reasoning:** Events (HTTP messages) are transient. State related to the request (e.g., AIImageGenerationRequest status, generated image metadata) is persisted in Odoo's database (REQ-AIGS-010), not the events themselves in an event store.
    
  - **Event Sourcing:**
    
    - **Necessary:** False
    - **Justification:** The current architecture doesn't mandate event sourcing. Odoo models manage state directly based on processing outcomes.
    - **Scope:**
      
      
    
  - **Technology Options:**
    
    
  - **Replay Capabilities:**
    
    - **Required:** True
    - **Scenarios:**
      
      - Transient network failures during Odoo->N8N webhook call.
      - Transient network failures during N8N->Odoo callback API call.
      - AI Service transient errors handled by N8N.
      
    - **Implementation:** HTTP client-side retries with backoff (REQ-IL-009). For persistent failures, manual re-triggering based on logs/DLQ analysis. N8N workflows can be re-run for specific executions if input data is available or logged.
    
  - **Retention Policy:**
    
    - **Strategy:** Logs of HTTP requests/responses (events) are retained as per operational log policies (REQ-ATEL-007). Data entities created/updated by event processing are retained per their own data model policies.
    - **Duration:** As per SRS 7.3 and REQ-ATEL-007.
    - **Archiving Approach:** Centralized logging solution handles log archiving.
    
  
- **Dead Letter Queue And Error Handling:**
  
  - **Dead Letter Strategy:**
    
    - **Approach:** N8N can be configured to route persistently failed callback attempts (N8N->Odoo) to an internal N8N error workflow or a dedicated DLQ mechanism if N8N supports it (e.g., send to an error-logging webhook/service). Odoo should log persistent failures when calling N8N's webhook.
    - **Queue Configuration:** Specific to N8N's capabilities for error handling in workflows.
    - **Processing Logic:** Manual review of DLQ'd events/logged errors to determine cause and potential for manual retry or correction (REQ-16-011).
    
  - **Retry Policies:**
    
    - **Error Type:** Transient HTTP errors (e.g., 5xx, network timeout) for Odoo->N8N webhook calls.  
**Max Retries:** 3  
**Backoff Strategy:** exponential  
**Delay Configuration:** Initial 1s, factor 2  
    - **Error Type:** Transient HTTP errors (e.g., 5xx, network timeout) for N8N->Odoo callback API calls.  
**Max Retries:** 3  
**Backoff Strategy:** exponential  
**Delay Configuration:** Initial 1s, factor 2 (Configured in N8N HTTP Request node)  
    - **Error Type:** Transient AI Service errors (handled within N8N workflow).  
**Max Retries:** 2  
**Backoff Strategy:** fixed  
**Delay Configuration:** 5s (Configured in N8N HTTP Request node to AI service)  
    
  - **Poison Message Handling:**
    
    - **Detection Mechanism:** For N8N->Odoo callback: If Odoo's callback handler repeatedly fails to process a message after successful delivery (e.g., due to malformed but valid JSON, or unresolvable business logic error based on payload), it should log a critical error. N8N's retry mechanism would eventually exhaust.
    - **Handling Strategy:** Log critical error in Odoo, alert administrators. N8N error workflow/DLQ for failed callbacks will also trigger alerts.
    - **Alerting Required:** True
    
  - **Error Notification:**
    
    - **Channels:**
      
      - Email
      - System Monitoring Dashboard Alerts
      
    - **Severity:** critical
    - **Recipients:**
      
      - Platform Administrators
      - Operations Team
      
    
  - **Recovery Procedures:**
    
    - **Scenario:** Persistent failure of Odoo calling N8N webhook.  
**Procedure:** Admin investigates Odoo logs, N8N availability. May manually re-trigger request from Odoo if appropriate.  
**Automation Level:** manual  
    - **Scenario:** Persistent failure of N8N calling Odoo callback API.  
**Procedure:** Admin investigates N8N error workflow/DLQ, Odoo callback API logs. May manually update Odoo request status and data if N8N processed AI request successfully but couldn't deliver result.  
**Automation Level:** manual  
    - **Scenario:** Persistent AI Service failure (reported by N8N).  
**Procedure:** Admin investigates AI service status. Odoo request status updated to 'failed' by N8N callback. User informed.  
**Automation Level:** semi-automated  
    
  
- **Event Versioning Strategy:**
  
  - **Schema Evolution Approach:**
    
    - **Strategy:** For JSON payloads in webhook/callback: Prefer additive changes (new optional fields) for backward compatibility. For breaking changes in Odoo's callback API, introduce a new API version (e.g., `/api/v2/influencegen/ai-image-callback`).
    - **Versioning Scheme:** Semantic versioning for API endpoints (e.g., v1, v2).
    - **Migration Strategy:** N8N workflows updated to call new Odoo API versions. Old Odoo API versions deprecated and eventually retired after a transition period.
    
  - **Compatibility Requirements:**
    
    - **Backward Compatible:** True
    - **Forward Compatible:** False
    - **Reasoning:** Odoo's callback API should be backward compatible to handle calls from older N8N workflow versions if updates are not simultaneous. N8N, as a client to Odoo's callback, might not support forward compatibility without updates.
    
  - **Version Identification:**
    
    - **Mechanism:** API endpoint path for Odoo's callback (e.g., `/v1/`, `/v2/`). Optionally, a `payloadVersion` field within the JSON event payload.
    - **Location:** header|payload|both
    - **Format:** string
    
  - **Consumer Upgrade Strategy:**
    
    - **Approach:** Coordinated updates for Odoo (callback API) and N8N (workflow calling the callback) for any breaking changes.
    - **Rollout Strategy:** Update N8N workflows first if Odoo callback supports both old and new versions (backward compatible change), or deploy new Odoo callback version then update N8N workflows.
    - **Rollback Procedure:** Revert N8N workflow to previous version. Revert Odoo code changes if necessary.
    
  - **Schema Registry:**
    
    - **Required:** False
    - **Technology:** N/A
    - **Governance:** N/A - Schema definitions maintained as part of API documentation (OpenAPI for Odoo callback - REQ-DDSI-009) and N8N workflow design.
    
  
- **Event Monitoring And Observability:**
  
  - **Monitoring Capabilities:**
    
    - **Capability:** HTTP Request/Response Logging for Odoo-N8N webhook and N8N-Odoo callback.  
**Justification:** Essential for troubleshooting integration issues (REQ-IL-013).  
**Implementation:** Odoo's standard logging for outgoing HTTP requests. N8N's execution log for webhook inputs and HTTP requests. Odoo's controller logging for callback API.  
    - **Capability:** N8N Workflow Execution Status Monitoring (success, failure, active).  
**Justification:** To track the processing of AI image generation requests (REQ-IL-013).  
**Implementation:** N8N's internal monitoring dashboard and logging. Centralized logging to capture N8N logs.  
    - **Capability:** API Error Rate and Latency Monitoring for Odoo callback API and N8N webhook calls.  
**Justification:** To detect performance degradation or failures in the integration (REQ-IL-013, REQ-12-003).  
**Implementation:** Centralized monitoring solution (e.g., Prometheus/Grafana, Datadog) analyzing logs or direct metrics from Odoo/N8N/API gateway if used.  
    
  - **Tracing And Correlation:**
    
    - **Tracing Required:** True
    - **Correlation Strategy:** Unique `correlationId` generated by Odoo for the initial request, propagated through N8N workflow, and included in N8N's call to AI service and subsequent callback to Odoo (REQ-ATEL-009, REQ-IL-014). The `requestId` (specific to AI gen) also aids correlation.
    - **Trace Id Propagation:** Via HTTP headers (e.g., `X-Correlation-ID`) and within JSON payloads.
    
  - **Performance Metrics:**
    
    - **Metric:** Odoo-N8N Webhook Call Latency  
**Threshold:** Avg < 500ms, P95 < 1s  
**Alerting:** True  
    - **Metric:** N8N-Odoo Callback API Latency  
**Threshold:** Avg < 500ms, P95 < 1s  
**Alerting:** True  
    - **Metric:** AI Image Generation End-to-End Time (Odoo request to Odoo result display)  
**Threshold:** Avg 10-20s (REQ-AIGS-008), P95 < 30s  
**Alerting:** True  
    - **Metric:** Webhook/Callback API Error Rate  
**Threshold:** > 5% over 5 mins  
**Alerting:** True  
    
  - **Event Flow Visualization:**
    
    - **Required:** False
    - **Tooling:** N/A - Distributed tracing tools (if implemented as per REQ-IL-014/REQ-12-005) would provide this. Not a separate event flow visualization tool requirement for this scope.
    - **Scope:** Primarily for Odoo-N8N-AI Service interactions.
    
  - **Alerting Requirements:**
    
    - **Condition:** Persistent Odoo->N8N webhook call failure (after retries).  
**Severity:** critical  
**Response Time:** Immediate  
**Escalation Path:**
    
    - Operations Team L1
    - Development Team L2
    
    - **Condition:** Persistent N8N->Odoo callback API call failure (after retries, from N8N DLQ/error workflow).  
**Severity:** critical  
**Response Time:** Immediate  
**Escalation Path:**
    
    - Operations Team L1
    - Development Team L2
    
    - **Condition:** N8N AI Image Generation Workflow execution failure (not AI service error, but workflow logic).  
**Severity:** critical  
**Response Time:** Immediate  
**Escalation Path:**
    
    - N8N Admin/Dev Team L1
    - Operations Team L2
    
    - **Condition:** High latency or error rate on webhook/callback APIs.  
**Severity:** warning  
**Response Time:** Within 15 mins  
**Escalation Path:**
    
    - Operations Team L1
    
    
  
- **Implementation Priority:**
  
  - **Component:** Webhook endpoint in N8N for AIImageGenerationRequested  
**Priority:** high  
**Dependencies:**
    
    
**Estimated Effort:** Low  
  - **Component:** Callback API endpoint in Odoo for AIImageGenerationCompleted/Failed  
**Priority:** high  
**Dependencies:**
    
    
**Estimated Effort:** Medium  
  - **Component:** N8N workflow for AI image generation, including AI service call and Odoo callback  
**Priority:** high  
**Dependencies:**
    
    - Webhook endpoint in N8N
    - Callback API endpoint in Odoo
    - AI Service API access
    
**Estimated Effort:** Medium-High  
  - **Component:** Retry logic in Odoo for N8N webhook calls  
**Priority:** high  
**Dependencies:**
    
    
**Estimated Effort:** Low  
  - **Component:** Retry logic in N8N for Odoo callback calls  
**Priority:** high  
**Dependencies:**
    
    
**Estimated Effort:** Low (N8N node config)  
  - **Component:** Correlation ID propagation mechanism  
**Priority:** high  
**Dependencies:**
    
    
**Estimated Effort:** Medium  
  - **Component:** Basic DLQ/Error handling in N8N for callback failures  
**Priority:** medium  
**Dependencies:**
    
    - N8N workflow
    
**Estimated Effort:** Low  
  
- **Risk Assessment:**
  
  - **Risk:** N8N becomes a single point of failure for AI image generation.  
**Impact:** high  
**Probability:** medium  
**Mitigation:** Robust N8N deployment (HA if possible, though not specified as required), comprehensive monitoring and alerting for N8N.  
  - **Risk:** Odoo callback API becomes overwhelmed by N8N callbacks.  
**Impact:** medium  
**Probability:** low  
**Mitigation:** Scalable Odoo deployment, rate limiting on callback API (REQ-IL-015), efficient callback handler logic in Odoo (REQ-IL-016).  
  - **Risk:** Inconsistent or lost correlation IDs hampering troubleshooting.  
**Impact:** medium  
**Probability:** medium  
**Mitigation:** Thorough testing of correlation ID propagation. Standardized logging.  
  - **Risk:** Schema mismatch between Odoo webhook payload and N8N expectation, or N8N callback payload and Odoo expectation.  
**Impact:** medium  
**Probability:** medium  
**Mitigation:** Clear API documentation (OpenAPI for Odoo callback - REQ-DDSI-009), contract testing or thorough integration testing. Versioning strategy for payloads/APIs.  
  
- **Recommendations:**
  
  - **Category:** Error Handling  
**Recommendation:** Ensure N8N workflows have robust error handling for AI service API calls, capturing specific error codes/messages from the AI service to pass back to Odoo.  
**Justification:** Improves diagnostic capabilities in Odoo and provides better feedback to users.  
**Priority:** high  
  - **Category:** Idempotency  
**Recommendation:** Rigorously test idempotency of the Odoo callback API handler using the `requestId` to prevent duplicate image record creation or status updates from N8N retries.  
**Justification:** Critical for data integrity with at-least-once delivery.  
**Priority:** high  
  - **Category:** Security  
**Recommendation:** Secure the N8N webhook and Odoo callback API endpoints using strong authentication (e.g., API keys, mutual TLS if feasible between Odoo and N8N servers) (REQ-IL-004, REQ-IL-007).  
**Justification:** Prevents unauthorized access and abuse of these critical integration points.  
**Priority:** high  
  - **Category:** Monitoring  
**Recommendation:** Implement specific monitoring dashboards for the Odoo-N8N-AI integration flow, tracking request volume, success/error rates at each step, and end-to-end processing time.  
**Justification:** Provides visibility into the health and performance of this critical asynchronous process (REQ-12-004).  
**Priority:** medium  
  


---

